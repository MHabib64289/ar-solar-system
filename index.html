<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>AR Solar System - Mobile Optimized</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
  <style>
    * { 
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    
    body { 
      margin: 0; 
      overflow: hidden; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      position: fixed;
      width: 100%;
      height: 100%;
      background: #000;
    }
    
    /* Mobile optimized UI */
    .ui-overlay {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      z-index: 999;
      color: white;
      background: rgba(0,0,0,0.85);
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.5;
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      max-width: calc(100vw - 20px);
      box-sizing: border-box;
    }
    
    .ui-overlay strong {
      display: block;
      font-size: 16px;
      margin-bottom: 6px;
      color: #4fc3f7;
      font-weight: 700;
    }
    
    .marker-type {
      display: inline-block;
      background: rgba(76, 175, 80, 0.2);
      color: #81c784;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-top: 4px;
    }
    
    .status {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,0.2);
      font-size: 11px;
      opacity: 0.9;
    }

    /* Mobile optimized controls */
    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      width: calc(100% - 40px);
      max-width: 400px;
    }
    
    button {
      background: linear-gradient(135deg, rgba(79, 195, 247, 0.95), rgba(41, 182, 246, 0.95));
      border: none;
      padding: 16px 12px;
      border-radius: 16px;
      font-weight: 700;
      cursor: pointer;
      font-size: 13px;
      color: white;
      box-shadow: 0 4px 12px rgba(79, 195, 247, 0.4);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      border: 2px solid rgba(255,255,255,0.3);
      min-height: 70px;
      touch-action: manipulation;
    }
    
    button:active {
      transform: scale(0.95);
      box-shadow: 0 2px 8px rgba(79, 195, 247, 0.6);
    }
    
    button .icon {
      font-size: 24px;
      line-height: 1;
    }
    
    button .text {
      font-size: 11px;
      font-weight: 600;
    }

    /* Marker help - mobile optimized */
    .marker-help {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 998;
      text-align: center;
      pointer-events: none;
      padding: 20px;
      max-width: calc(100vw - 40px);
    }
    
    .marker-frame {
      width: min(60vw, 240px);
      height: min(60vw, 240px);
      border: 3px dashed rgba(79, 195, 247, 0.8);
      border-radius: 20px;
      margin: 0 auto 15px;
      animation: pulse 2s infinite;
      box-shadow: 0 0 30px rgba(79, 195, 247, 0.4);
      background: rgba(79, 195, 247, 0.05);
    }
    
    @keyframes pulse {
      0%, 100% { 
        opacity: 0.5;
        transform: scale(1);
        border-color: rgba(79, 195, 247, 0.5);
      }
      50% { 
        opacity: 1;
        transform: scale(1.05);
        border-color: rgba(79, 195, 247, 1);
      }
    }
    
    .marker-text {
      color: white;
      background: rgba(0,0,0,0.9);
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1);
      line-height: 1.5;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(79, 195, 247, 0.3);
      border-top: 4px solid #4fc3f7;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 16px;
      font-weight: 600;
      margin-top: 10px;
    }

    /* Permission prompt */
    .permission-prompt {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 1001;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
    }
    
    .permission-prompt.show {
      display: flex;
    }
    
    .permission-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }
    
    .permission-title {
      font-size: 20px;
      font-weight: 700;
      color: white;
      margin-bottom: 15px;
    }
    
    .permission-text {
      font-size: 14px;
      color: #aaa;
      line-height: 1.6;
      max-width: 300px;
      margin-bottom: 25px;
    }
    
    .permission-btn {
      background: linear-gradient(135deg, #4caf50, #45a049);
      color: white;
      border: none;
      padding: 16px 40px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
      cursor: pointer;
    }
    
    .permission-btn:active {
      transform: scale(0.95);
    }

    /* Landscape warning */
    @media (orientation: landscape) and (max-height: 500px) {
      .landscape-warning {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.95);
        z-index: 1002;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
        padding: 20px;
      }
      
      .landscape-warning .icon {
        font-size: 50px;
        margin-bottom: 15px;
      }
      
      .landscape-warning .text {
        font-size: 18px;
        font-weight: 600;
      }
    }
    
    /* Tablet landscape */
    @media (min-width: 768px) and (orientation: landscape) {
      .controls {
        grid-template-columns: repeat(4, 1fr);
        max-width: 600px;
      }
      
      button {
        min-height: 80px;
      }
    }
    
    /* Small phones */
    @media (max-width: 360px) {
      .ui-overlay {
        font-size: 11px;
        padding: 10px 14px;
      }
      
      .ui-overlay strong {
        font-size: 14px;
      }
      
      button {
        padding: 14px 10px;
        font-size: 12px;
        min-height: 65px;
      }
      
      button .icon {
        font-size: 20px;
      }
      
      button .text {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Permission Prompt -->
  <div class="permission-prompt" id="permissionPrompt">
    <div class="permission-icon">üì∑</div>
    <div class="permission-title">Izinkan Akses Kamera</div>
    <div class="permission-text">
      Aplikasi AR memerlukan akses kamera untuk mendeteksi marker dan menampilkan objek 3D
    </div>
    <button class="permission-btn" onclick="requestCamera()">Izinkan Kamera</button>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading">
    <div class="spinner"></div>
    <div class="loading-text">Memuat AR Solar System...</div>
  </div>

  <!-- UI Overlay -->
  <div class="ui-overlay">
    <strong>üåç AR Solar System HD</strong>
    <div>
      <span class="marker-type">Hiro Marker</span>
    </div>
    <div class="status" id="status">Memuat...</div>
  </div>

  <!-- Marker Help -->
  <div class="marker-help" id="markerHelp">
    <div class="marker-frame"></div>
    <div class="marker-text">
      Arahkan kamera ke<br><strong>HIRO MARKER</strong>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <button onclick="toggleEclipse()" ontouchstart="">
      <span class="icon" id="eclipseIcon">üåë</span>
      <span class="text" id="eclipseText">Gerhana</span>
    </button>
    <button onclick="toggleSpeed()" ontouchstart="">
      <span class="icon">‚ö°</span>
      <span class="text" id="speedText">1x</span>
    </button>
    <button onclick="toggleRotate()" ontouchstart="">
      <span class="icon" id="rotateIcon">üîÑ</span>
      <span class="text" id="rotateText">Putar</span>
    </button>
    <button onclick="resetCamera()" ontouchstart="">
      <span class="icon">üì∑</span>
      <span class="text">Reset</span>
    </button>
  </div>

  <!-- AR Scene -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; videoTexture: true;"
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true; alpha: true; colorManagement: true;"
    loading-screen="enabled: false"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0;"
    id="arScene">
    
    <a-assets timeout="30000">
      <img id="earthTexture" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg" crossorigin="anonymous">
      <img id="moonTexture" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/moon_1024.jpg" crossorigin="anonymous">
      <img id="sunTexture" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/sun.jpg" crossorigin="anonymous">
    </a-assets>

    <a-entity camera look-controls="enabled: false"></a-entity>

  <a-marker 
  type="pattern" 
  url="pattern-earth.patt"
  id="mainMarker" 
  smooth="true" 
  smoothCount="10" 
  smoothTolerance="0.01" 
  smoothThreshold="5">
      
      <a-entity id="solarSystem" scale="0.8 0.8 0.8" position="0 0 0">
        
        <a-entity id="sun" position="-4 0.5 0">
          <a-sphere radius="0.8" src="#sunTexture" segments-width="48" segments-height="48" material="emissive: #ff6600; emissiveIntensity: 0.8; shader: standard" animation="property: rotation; to: 0 360 0; dur: 20000; loop: true; easing: linear"></a-sphere>
          <a-sphere radius="0.9" color="#ffcc44" segments-width="24" segments-height="24" material="transparent: true; opacity: 0.4; side: double; shader: flat" animation="property: scale; to: 1.15 1.15 1.15; dir: alternate; dur: 2000; loop: true; easing: easeInOutSine"></a-sphere>
          <a-sphere radius="1.05" color="#ff9933" segments-width="24" segments-height="24" material="transparent: true; opacity: 0.25; side: double; shader: flat" animation="property: scale; to: 1.2 1.2 1.2; dir: alternate; dur: 2500; loop: true; easing: easeInOutSine"></a-sphere>
          <a-sphere radius="1.25" color="#ff7722" segments-width="24" segments-height="24" material="transparent: true; opacity: 0.15; side: double; shader: flat" animation="property: scale; to: 1.3 1.3 1.3; dir: alternate; dur: 3000; loop: true; easing: easeInOutSine"></a-sphere>
          <a-sphere id="corona1" radius="1.1" color="#ffffdd" segments-width="24" segments-height="24" material="transparent: true; opacity: 0; side: back; shader: flat" visible="false"></a-sphere>
          <a-sphere id="corona2" radius="1.4" color="#ffffaa" segments-width="24" segments-height="24" material="transparent: true; opacity: 0; side: back; shader: flat" visible="false"></a-sphere>
          <a-sphere id="corona3" radius="1.8" color="#ffeeaa" segments-width="24" segments-height="24" material="transparent: true; opacity: 0; side: back; shader: flat" visible="false"></a-sphere>
        </a-entity>

        <a-entity id="earthSystem" rotation="0 0 -23.4">
          <a-sphere id="earth" radius="0.65" src="#earthTexture" segments-width="48" segments-height="48" material="shader: standard; metalness: 0.1; roughness: 0.7" animation="property: rotation; to: 0 360 0; dur: 12000; loop: true; easing: linear">
            <a-sphere radius="0.651" color="#112244" segments-width="32" segments-height="32" material="transparent: true; opacity: 0.3; metalness: 0.9; roughness: 0.2; shader: standard"></a-sphere>
            <a-sphere radius="0.66" color="#ffffff" segments-width="32" segments-height="32" material="transparent: true; opacity: 0.5; shader: standard" animation="property: rotation; to: 0 370 0; dur: 14000; loop: true; easing: linear"></a-sphere>
            <a-sphere radius="0.7" color="#5599ff" segments-width="24" segments-height="24" material="transparent: true; opacity: 0.2; side: back; shader: flat"></a-sphere>
            <a-sphere radius="0.75" color="#3388ff" segments-width="16" segments-height="16" material="transparent: true; opacity: 0.1; side: back; shader: flat"></a-sphere>
          </a-sphere>

          <a-entity id="moonOrbit" animation="property: rotation; to: 0 360 0; dur: 18000; loop: true; easing: linear; pauseEvents: pauseRotation; resumeEvents: resumeRotation">
            <a-sphere id="moon" position="2 0.2 0" radius="0.18" src="#moonTexture" segments-width="32" segments-height="32" material="shader: standard; roughness: 0.95; metalness: 0" animation="property: rotation; to: 0 360 0; dur: 27000; loop: true; easing: linear"></a-sphere>
            <a-ring radius-inner="1.95" radius-outer="1.98" color="#99aacc" segments-theta="64" material="transparent: true; opacity: 0.25; side: double; shader: flat" rotation="-90 0 0"></a-ring>
          </a-entity>
        </a-entity>

        <a-entity id="stars" position="0 0 0"></a-entity>

        <a-light type="ambient" color="#404050" intensity="0.6"></a-light>
        <a-light type="directional" color="#ffffee" intensity="1.5" position="-4 1 2" id="sunLight"></a-light>
        <a-light type="point" color="#6688aa" intensity="0.3" position="3 -1 -2"></a-light>
      </a-entity>
    </a-marker>
  </a-scene>

  <script>
    let eclipseMode = false;
    let speedMultiplier = 1;
    let rotationPaused = false;
    let markerVisible = false;

    // Request camera permission
    function requestCamera() {
      document.getElementById('permissionPrompt').classList.remove('show');
      updateStatus('Mengaktifkan kamera...');
    }

    // Check if mobile device
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (isMobile) {
      updateStatus('Mobile device terdeteksi ‚úÖ');
    }

    // Create optimized stars for mobile
    window.addEventListener('load', () => {
      setTimeout(() => {
        const loading = document.getElementById('loading');
        if (loading) {
          loading.style.opacity = '0';
          loading.style.transition = 'opacity 0.5s';
          setTimeout(() => loading.remove(), 500);
        }
      }, 2000);

      const starsEl = document.querySelector('#stars');
      if (starsEl) {
        const starCount = isMobile ? 100 : 200; // Reduced for mobile
        for (let i = 0; i < starCount; i++) {
          const star = document.createElement('a-sphere');
          const x = (Math.random() - 0.5) * 30;
          const y = (Math.random() - 0.5) * 30;
          const z = (Math.random() - 0.5) * 30;
          const size = Math.random() * 0.03 + 0.01;
          const brightness = Math.random() * 0.5 + 0.5;
          
          star.setAttribute('position', `${x} ${y} ${z}`);
          star.setAttribute('radius', size);
          star.setAttribute('color', '#ffffff');
          star.setAttribute('material', `shader: flat; opacity: ${brightness}`);
          
          if (Math.random() > 0.8) { // Less twinkling on mobile
            star.setAttribute('animation', `property: material.opacity; to: ${brightness * 0.3}; dur: ${Math.random() * 2000 + 1000}; dir: alternate; loop: true; easing: easeInOutSine`);
          }
          
          starsEl.appendChild(star);
        }
      }

      updateStatus('Siap scan marker üì±');
    });

    // Marker detection
    const marker = document.querySelector('#mainMarker');
    if (marker) {
      marker.addEventListener('markerFound', () => {
        markerVisible = true;
        document.getElementById('markerHelp').classList.add('hidden');
        updateStatus('‚úÖ Marker terdeteksi!');
        
        // Haptic feedback on mobile
        if (navigator.vibrate) {
          navigator.vibrate(50);
        }
      });

      marker.addEventListener('markerLost', () => {
        markerVisible = false;
        document.getElementById('markerHelp').classList.remove('hidden');
        updateStatus('‚ùå Marker hilang');
      });
    }

    // Touch-optimized functions
    function toggleEclipse() {
      eclipseMode = !eclipseMode;
      const corona1 = document.querySelector('#corona1');
      const corona2 = document.querySelector('#corona2');
      const corona3 = document.querySelector('#corona3');
      const sunLight = document.querySelector('#sunLight');
      const icon = document.querySelector('#eclipseIcon');
      const text = document.querySelector('#eclipseText');
      
      if (eclipseMode) {
        if (corona1) {
          corona1.setAttribute('visible', 'true');
          corona1.setAttribute('material', 'opacity', '0.5');
          corona1.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear');
        }
        if (corona2) {
          corona2.setAttribute('visible', 'true');
          corona2.setAttribute('material', 'opacity', '0.3');
          corona2.setAttribute('animation', 'property: rotation; to: 0 -360 0; dur: 12000; loop: true; easing: linear');
        }
        if (corona3) {
          corona3.setAttribute('visible', 'true');
          corona3.setAttribute('material', 'opacity', '0.2');
          corona3.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 16000; loop: true; easing: linear');
        }
        
        if (sunLight) sunLight.setAttribute('intensity', '0.3');
        
        const moonOrbit = document.querySelector('#moonOrbit');
        if (moonOrbit) {
          moonOrbit.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 35000; loop: true; easing: linear');
        }
        
        icon.textContent = '‚òÄÔ∏è';
        text.textContent = 'Normal';
        updateStatus('üåë Gerhana AKTIF!');
      } else {
        if (corona1) corona1.setAttribute('visible', 'false');
        if (corona2) corona2.setAttribute('visible', 'false');
        if (corona3) corona3.setAttribute('visible', 'false');
        
        if (sunLight) sunLight.setAttribute('intensity', '1.5');
        
        const moonOrbit = document.querySelector('#moonOrbit');
        if (moonOrbit) {
          moonOrbit.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 18000; loop: true; easing: linear');
        }
        
        icon.textContent = 'üåë';
        text.textContent = 'Gerhana';
        updateStatus('‚òÄÔ∏è Mode Normal');
      }
      
      if (navigator.vibrate) navigator.vibrate(30);
    }

    function toggleSpeed() {
      const speeds = [1, 2, 0.5, 4];
      const currentIndex = speeds.indexOf(speedMultiplier);
      speedMultiplier = speeds[(currentIndex + 1) % speeds.length];
      
      const speedText = document.querySelector('#speedText');
      speedText.textContent = `${speedMultiplier}x`;
      
      const earth = document.querySelector('#earth');
      const moonOrbit = document.querySelector('#moonOrbit');
      
      if (earth) {
        const baseDur = 12000;
        earth.setAttribute('animation', `property: rotation; to: 0 360 0; dur: ${baseDur / speedMultiplier}; loop: true; easing: linear`);
      }
      
      if (moonOrbit) {
        const baseDur = eclipseMode ? 35000 : 18000;
        moonOrbit.setAttribute('animation', `property: rotation; to: 0 360 0; dur: ${baseDur / speedMultiplier}; loop: true; easing: linear`);
      }
      
      updateStatus(`‚ö° ${speedMultiplier}x`);
      if (navigator.vibrate) navigator.vibrate(30);
    }

    function toggleRotate() {
      rotationPaused = !rotationPaused;
      const icon = document.querySelector('#rotateIcon');
      const text = document.querySelector('#rotateText');
      const moonOrbit = document.querySelector('#moonOrbit');
      
      if (rotationPaused) {
        if (moonOrbit) moonOrbit.emit('pauseRotation');
        icon.textContent = '‚ñ∂Ô∏è';
        text.textContent = 'Lanjut';
        updateStatus('‚è∏Ô∏è PAUSE');
      } else {
        if (moonOrbit) moonOrbit.emit('resumeRotation');
        icon.textContent = 'üîÑ';
        text.textContent = 'Putar';
        updateStatus('‚ñ∂Ô∏è PLAY');
      }
      
      if (navigator.vibrate) navigator.vibrate(30);
    }

    function resetCamera() {
      const solarSystem = document.querySelector('#solarSystem');
      if (solarSystem) {
        solarSystem.setAttribute('scale', '0.8 0.8 0.8');
        solarSystem.setAttribute('position', '0 0 0');
      }
      updateStatus('üì∑ Reset');
      if (navigator.vibrate) navigator.vibrate([30, 50, 30]);
    }

    function updateStatus(msg) {
      const statusEl = document.getElementById('status');
      if (statusEl) statusEl.textContent = msg;
    }

    // Prevent default touch behaviors
    document.addEventListener('touchmove', (e) => {
      if (e.target.tagName !== 'BUTTON') {
        e.preventDefault();
      }
    }, { passive: false });

    // AR scene ready
    const arScene = document.querySelector('#arScene');
    if (arScene) {
      arScene.addEventListener('arjs-video-loaded', () => {
        updateStatus('üìπ Kamera aktif!');
      });
    }

    // Handle orientation change
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        if (window.innerHeight < 500 && Math.abs(window.orientation) === 90) {
          updateStatus('‚Üª Putar ke portrait untuk pengalaman terbaik');
        }
      }, 200);
    });
  </script>
</body>
</html>

