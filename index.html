<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>AR Solar System - Earth Marker</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
    }
    
    body {
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    /* UI Overlay - Mobile Optimized */
    .ui-overlay {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      z-index: 999;
      color: white;
      background: rgba(0,0,0,0.85);
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.5;
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      pointer-events: none;
    }
    
    .ui-overlay strong {
      display: block;
      font-size: 16px;
      margin-bottom: 6px;
      color: #4fc3f7;
      font-weight: 700;
    }
    
    .marker-type {
      display: inline-block;
      background: rgba(76, 175, 80, 0.2);
      color: #81c784;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .status {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,0.2);
      font-size: 11px;
    }

    /* Controls - Better Mobile Layout */
    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      width: calc(100% - 40px);
      max-width: 400px;
      pointer-events: all;
    }
    
    button {
      background: linear-gradient(135deg, #4fc3f7, #29b6f6);
      border: none;
      padding: 16px 12px;
      border-radius: 16px;
      font-weight: 700;
      font-size: 13px;
      color: white;
      box-shadow: 0 4px 12px rgba(79, 195, 247, 0.4);
      transition: transform 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      min-height: 70px;
      touch-action: manipulation;
      border: 2px solid rgba(255,255,255,0.3);
    }
    
    button:active {
      transform: scale(0.95);
    }
    
    button .icon {
      font-size: 24px;
    }
    
    button .text {
      font-size: 11px;
    }

    /* Marker Help */
    .marker-help {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 998;
      text-align: center;
      pointer-events: none;
    }
    
    .marker-frame {
      width: min(60vw, 240px);
      height: min(60vw, 240px);
      border: 3px dashed rgba(79, 195, 247, 0.8);
      border-radius: 20px;
      margin: 0 auto 15px;
      animation: pulse 2s infinite;
      box-shadow: 0 0 30px rgba(79, 195, 247, 0.4);
    }
    
    @keyframes pulse {
      0%, 100% { 
        opacity: 0.5;
        border-color: rgba(79, 195, 247, 0.5);
      }
      50% { 
        opacity: 1;
        border-color: rgba(79, 195, 247, 1);
      }
    }
    
    .marker-text {
      color: white;
      background: rgba(0,0,0,0.9);
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.5);
    }
    
    .hidden {
      display: none !important;
    }
    
    @media (max-width: 360px) {
      button {
        padding: 12px 10px;
        min-height: 65px;
      }
      button .icon {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>


  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true; alpha: true;"
    id="arScene">
    
    <a-assets timeout="30000">
      <img id="earthTexture" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg" crossorigin="anonymous">
      <img id="moonTexture" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/moon_1024.jpg" crossorigin="anonymous">
      <img id="sunTexture" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/sun.jpg" crossorigin="anonymous">
    </a-assets>

    <a-entity camera look-controls="enabled: false"></a-entity>

    <!-- Hiro Marker (Default - Always Works) -->
    <a-marker preset="hiro" id="hiroMarker" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
      <a-entity id="solarSystem" scale="0.7 0.7 0.7" position="0 0 0">
        
        <!-- Sun -->
        <a-entity id="sun" position="-3.5 0.3 0">
          <a-sphere radius="0.7" src="#sunTexture" segments-width="32" segments-height="32" material="emissive: #ff6600; emissiveIntensity: 0.8" animation="property: rotation; to: 0 360 0; dur: 20000; loop: true; easing: linear"></a-sphere>
          <a-sphere radius="0.8" color="#ffcc44" segments-width="16" segments-height="16" material="transparent: true; opacity: 0.4; side: double; shader: flat" animation="property: scale; to: 1.15 1.15 1.15; dir: alternate; dur: 2000; loop: true"></a-sphere>
          <a-sphere radius="0.95" color="#ff9933" segments-width="16" segments-height="16" material="transparent: true; opacity: 0.25; side: double; shader: flat" animation="property: scale; to: 1.2 1.2 1.2; dir: alternate; dur: 2500; loop: true"></a-sphere>
          <a-sphere id="corona1" radius="1" color="#ffffdd" segments-width="16" segments-height="16" material="transparent: true; opacity: 0; side: back; shader: flat" visible="false"></a-sphere>
          <a-sphere id="corona2" radius="1.3" color="#ffffaa" segments-width="16" segments-height="16" material="transparent: true; opacity: 0; side: back; shader: flat" visible="false"></a-sphere>
        </a-entity>

        <!-- Earth -->
        <a-entity id="earthSystem" rotation="0 0 -23.4">
          <a-sphere id="earth" radius="0.6" src="#earthTexture" segments-width="32" segments-height="32" material="shader: standard; metalness: 0.1; roughness: 0.7" animation="property: rotation; to: 0 360 0; dur: 12000; loop: true; easing: linear">
            <a-sphere radius="0.605" color="#112244" segments-width="24" segments-height="24" material="transparent: true; opacity: 0.3; metalness: 0.9; roughness: 0.2"></a-sphere>
            <a-sphere radius="0.61" color="#ffffff" segments-width="24" segments-height="24" material="transparent: true; opacity: 0.5" animation="property: rotation; to: 0 370 0; dur: 14000; loop: true; easing: linear"></a-sphere>
            <a-sphere radius="0.65" color="#5599ff" segments-width="16" segments-height="16" material="transparent: true; opacity: 0.2; side: back; shader: flat"></a-sphere>
          </a-sphere>

          <!-- Moon -->
          <a-entity id="moonOrbit" animation="property: rotation; to: 0 360 0; dur: 18000; loop: true; easing: linear; pauseEvents: pauseRotation; resumeEvents: resumeRotation">
            <a-sphere id="moon" position="1.8 0.2 0" radius="0.16" src="#moonTexture" segments-width="24" segments-height="24" material="shader: standard; roughness: 0.95" animation="property: rotation; to: 0 360 0; dur: 27000; loop: true; easing: linear"></a-sphere>
            <a-ring radius-inner="1.75" radius-outer="1.78" color="#99aacc" segments-theta="48" material="transparent: true; opacity: 0.25; side: double" rotation="-90 0 0"></a-ring>
          </a-entity>
        </a-entity>

        <!-- Stars (Reduced for performance) -->
        <a-entity id="stars" position="0 0 0"></a-entity>

        <!-- Lights -->
        <a-light type="ambient" color="#404050" intensity="0.6"></a-light>
        <a-light type="directional" color="#ffffee" intensity="1.5" position="-3.5 1 2" id="sunLight"></a-light>
      </a-entity>
    </a-marker>

    <!-- Earth Custom Marker (Backup) -->
    <a-marker type="pattern" url="pattern-earth.patt" id="earthMarker" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
      <a-entity id="solarSystem2" scale="0.7 0.7 0.7" position="0 0 0">
        <a-entity id="sun2" position="-3.5 0.3 0">
          <a-sphere radius="0.7" src="#sunTexture" segments-width="32" segments-height="32" material="emissive: #ff6600; emissiveIntensity: 0.8" animation="property: rotation; to: 0 360 0; dur: 20000; loop: true; easing: linear"></a-sphere>
          <a-sphere radius="0.8" color="#ffcc44" segments-width="16" segments-height="16" material="transparent: true; opacity: 0.4; side: double; shader: flat" animation="property: scale; to: 1.15 1.15 1.15; dir: alternate; dur: 2000; loop: true"></a-sphere>
        </a-entity>
        <a-entity id="earthSystem2" rotation="0 0 -23.4">
          <a-sphere radius="0.6" src="#earthTexture" segments-width="32" segments-height="32" animation="property: rotation; to: 0 360 0; dur: 12000; loop: true; easing: linear">
            <a-sphere radius="0.61" color="#ffffff" segments-width="24" segments-height="24" material="transparent: true; opacity: 0.5" animation="property: rotation; to: 0 370 0; dur: 14000; loop: true; easing: linear"></a-sphere>
          </a-sphere>
          <a-entity animation="property: rotation; to: 0 360 0; dur: 18000; loop: true; easing: linear">
            <a-sphere position="1.8 0.2 0" radius="0.16" src="#moonTexture" segments-width="24" segments-height="24" animation="property: rotation; to: 0 360 0; dur: 27000; loop: true; easing: linear"></a-sphere>
          </a-entity>
        </a-entity>
        <a-light type="ambient" color="#404050" intensity="0.6"></a-light>
        <a-light type="directional" color="#ffffee" intensity="1.5" position="-3.5 1 2"></a-light>
      </a-entity>
    </a-marker>
  </a-scene>

  <script>
    let eclipseMode = false;
    let speedMultiplier = 1;
    let rotationPaused = false;
    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

    window.addEventListener('load', () => {
      // Create minimal stars for performance
      const starsEl = document.querySelector('#stars');
      if (starsEl) {
        const starCount = isMobile ? 50 : 100;
        for (let i = 0; i < starCount; i++) {
          const star = document.createElement('a-sphere');
          const x = (Math.random() - 0.5) * 25;
          const y = (Math.random() - 0.5) * 25;
          const z = (Math.random() - 0.5) * 25;
          star.setAttribute('position', `${x} ${y} ${z}`);
          star.setAttribute('radius', '0.02');
          star.setAttribute('color', '#ffffff');
          star.setAttribute('material', 'shader: flat');
          starsEl.appendChild(star);
        }
      }
      updateStatus('üìπ Siap scan marker');
    });

    // Marker detection for Hiro
    const hiroMarker = document.querySelector('#hiroMarker');
    if (hiroMarker) {
      hiroMarker.addEventListener('markerFound', () => {
        document.getElementById('markerHelp').classList.add('hidden');
        updateStatus('‚úÖ Hiro Marker terdeteksi!');
        if (navigator.vibrate) navigator.vibrate(50);
      });
      hiroMarker.addEventListener('markerLost', () => {
        document.getElementById('markerHelp').classList.remove('hidden');
        updateStatus('‚ùå Marker hilang');
      });
    }

    // Marker detection for Earth
    const earthMarker = document.querySelector('#earthMarker');
    if (earthMarker) {
      earthMarker.addEventListener('markerFound', () => {
        document.getElementById('markerHelp').classList.add('hidden');
        updateStatus('‚úÖ Earth Marker terdeteksi! üåè');
        if (navigator.vibrate) navigator.vibrate([50, 30, 50]);
      });
      earthMarker.addEventListener('markerLost', () => {
        document.getElementById('markerHelp').classList.remove('hidden');
        updateStatus('‚ùå Marker hilang');
      });
    }

    function toggleEclipse() {
      eclipseMode = !eclipseMode;
      const corona1 = document.querySelector('#corona1');
      const corona2 = document.querySelector('#corona2');
      const sunLight = document.querySelector('#sunLight');
      const icon = document.querySelector('#eclipseIcon');
      const text = document.querySelector('#eclipseText');
      
      if (eclipseMode) {
        if (corona1) {
          corona1.setAttribute('visible', 'true');
          corona1.setAttribute('material', 'opacity', '0.5');
        }
        if (corona2) {
          corona2.setAttribute('visible', 'true');
          corona2.setAttribute('material', 'opacity', '0.3');
        }
        if (sunLight) sunLight.setAttribute('intensity', '0.3');
        icon.textContent = '‚òÄÔ∏è';
        text.textContent = 'Normal';
        updateStatus('üåë Gerhana ON');
      } else {
        if (corona1) corona1.setAttribute('visible', 'false');
        if (corona2) corona2.setAttribute('visible', 'false');
        if (sunLight) sunLight.setAttribute('intensity', '1.5');
        icon.textContent = 'üåë';
        text.textContent = 'Gerhana';
        updateStatus('‚òÄÔ∏è Normal');
      }
      if (navigator.vibrate) navigator.vibrate(30);
    }

    function toggleSpeed() {
      const speeds = [1, 2, 0.5];
      const currentIndex = speeds.indexOf(speedMultiplier);
      speedMultiplier = speeds[(currentIndex + 1) % speeds.length];
      document.querySelector('#speedText').textContent = `${speedMultiplier}x`;
      updateStatus(`‚ö° ${speedMultiplier}x`);
      if (navigator.vibrate) navigator.vibrate(30);
    }

    function toggleRotate() {
      rotationPaused = !rotationPaused;
      const icon = document.querySelector('#rotateIcon');
      const text = document.querySelector('#rotateText');
      const moonOrbit = document.querySelector('#moonOrbit');
      if (rotationPaused) {
        if (moonOrbit) moonOrbit.emit('pauseRotation');
        icon.textContent = '‚ñ∂Ô∏è';
        text.textContent = 'Play';
        updateStatus('‚è∏Ô∏è Pause');
      } else {
        if (moonOrbit) moonOrbit.emit('resumeRotation');
        icon.textContent = 'üîÑ';
        text.textContent = 'Putar';
        updateStatus('‚ñ∂Ô∏è Play');
      }
      if (navigator.vibrate) navigator.vibrate(30);
    }

    function resetCamera() {
      const solarSystem = document.querySelector('#solarSystem');
      if (solarSystem) {
        solarSystem.setAttribute('scale', '0.7 0.7 0.7');
        solarSystem.setAttribute('position', '0 0 0');
      }
      updateStatus('üì∑ Reset');
      if (navigator.vibrate) navigator.vibrate([30, 50, 30]);
    }

    function updateStatus(msg) {
      const statusEl = document.getElementById('status');
      if (statusEl) statusEl.textContent = msg;
    }
  </script>
</body>
</html>

